{"version":3,"sources":["webpack://siritos-cms/./modules/src/xibo-calendar-render.js"],"names":["jQuery","fn","extend","xiboCalendarRender","options","events","defaults","duration","previewWidth","previewHeight","scaleOverride","$","TODAY","moment","INITIAL_YEAR","year","INITIAL_MONTH","month","INITIAL_DATE","date","TIME_FORMAT","timeFormat","DEFAULT_DAY_START_TIME","startOf","format","DEFAULT_DAY_END_TIME","endOf","GRID_STEP","gridStep","DEFAULT_FONT_SIZE","DEFAULT_FONT_SCALE","textScale","maxEventPerDay","maxEventPerDayWithExtra","weekdaysNames","weekdays","weekdayNameLength","weekdaysMin","weekdaysShort","monthsNames","months","monthNameLength","monthsShort","createCalendar","addEventsToCalendar","applyStyleOptions","toggleClass","showHeader","css","mainBackgroundColor","gridColor","gridTextColor","dayBgColor","dayTextColor","todayTextColor","nowMarkerColor","dayOtherMonthBgColor","dayOtherMonthTextColor","headerBgColor","headerTextColor","weekDaysHeaderBgColor","weekDaysHeaderTextColor","eventBgColor","eventTextColor","dailyEventBgColor","dailyEventTextColor","multiDayEventBgColor","multiDayEventTextColor","aditionalEventsBgColor","aditionalEventsTextColor","noEventsBgColor","noEventsTextColor","getWeekday","weekday","createNowMarker","$container","timeData","dayViewDuration","end","start","$nowMarker","nowTimeInMinutes","diff","as","eventPositionPerc","appendTo","addEventsToCalendarBase","forEach","event","startDate","allDayEvent","isSame","endDate","allDay","subtract","eventTotalDays","currentDayOfEvent","momentAux","addEventToDay","add","getEventContainer","calendarType","find","getAllDayEventsContainer","$newEvent","weekDay","eventDuration","addClass","htmlToAdd","summary","html","remainingDays","$dailyEventsContainer","slots","data","daySlot","undefined","index","length","slot","push","dayAfter","$newContainer","dataSlots","updateContainerExtraEvents","$eventsContainer","containerData","eventData","eventHeightAdj","eventLevel","newLevel","level","eventHeight","height","parseFloat","prependTo","bodyFontSize","parseInt","split","singleEventHeight","extraEventsHeight","Math","floor","maxEventsForThisDay","numberOfExtendedEvents","filter","ev","idx","remove","numEventsToHide","numExtendedEventsFix","append","createCalendarHourGrid","gridSpacing","$calendarContainer","addedEvents","getDayContainer","$dayContainerTemp","$dayContainerTitle","attr","$dayContainer","$dayContainerEvents","showDescription","description","useDateRange","rangeStart","rangeEnd","showNowMarker","$dayEventsContainer","$targetElement","each","insertBefore","noEventsMessage","$hourGrid","$dayTitle","$weekDay","today","day","dayOfMonth","$dayOfMonthElement","startTime","endTime","$dayElement","$daysOfWeek","$calendarDays","currentWeekDays","createDaysForCurrentWeek","appendDay","startOfWeek","Array","map","dayOfWeek","currentMonthDays","previousMonthDays","nextMonthDays","createDaysForCurrentMonth","createDaysForPreviousMonth","createDaysForNextMonth","days","isCurrentMonth","getNumberOfDaysInMonth","daysInMonth","firstDayOfTheMonthWeekday","previousMonth","visibleNumberOfDaysFromPreviousMonth","previousMonthLastMondayDayOfMonth","lastDayOfTheMonthWeekday","nextMonth","visibleNumberOfDaysFromNextMonth"],"mappings":"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","file":"xibo-calendar-render.js","sourcesContent":["/**\r\n * Copyright (C) 2021 Xibo Signage Ltd\r\n *\r\n * Xibo - Digital Signage - http://www.xibo.org.uk\r\n *\r\n * This file is part of Xibo.\r\n *\r\n * Xibo is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * any later version.\r\n *\r\n * Xibo is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with Xibo.  If not, see <http://www.gnu.org/licenses/>.\r\n */\r\njQuery.fn.extend({\r\n  xiboCalendarRender: function(options, events) {\r\n    // Default options\r\n    const defaults = {\r\n      duration: '30',\r\n      previewWidth: 0,\r\n      previewHeight: 0,\r\n      scaleOverride: 0,\r\n    };\r\n\r\n    options = $.extend({}, defaults, options);\r\n\r\n    // Global constants\r\n    const TODAY = moment();\r\n\r\n    const INITIAL_YEAR = moment().year();\r\n\r\n    // NOTE: month format for momentjs is 1-12 and month value is zero indexed\r\n    const INITIAL_MONTH = moment().month();\r\n    const INITIAL_DATE = moment().date();\r\n\r\n    const TIME_FORMAT = options.timeFormat || 'HH:mm';\r\n\r\n    const DEFAULT_DAY_START_TIME = moment().startOf('day').format(TIME_FORMAT);\r\n    const DEFAULT_DAY_END_TIME = moment().endOf('day').format(TIME_FORMAT);\r\n\r\n    const GRID_STEP = options.gridStep &&\r\n      options.gridStep > 0 ? options.gridStep : 60;\r\n\r\n    const DEFAULT_FONT_SIZE = 16;\r\n    const DEFAULT_FONT_SCALE = options.textScale || 1;\r\n\r\n    // Global vars for all calendar types\r\n    let maxEventPerDay;\r\n    let maxEventPerDayWithExtra;\r\n\r\n    let weekdaysNames = moment.weekdays(true);\r\n    if (options.weekdayNameLength == 'short') {\r\n      weekdaysNames = moment.weekdaysMin(true);\r\n    } else if (options.weekdayNameLength == 'medium') {\r\n      weekdaysNames = moment.weekdaysShort(true);\r\n    }\r\n\r\n    let monthsNames = moment.months();\r\n    if (options.monthNameLength == 'short') {\r\n      monthsNames = moment.monthsShort();\r\n    }\r\n\r\n    // Main functions to be overriden\r\n    let createCalendar = () => {};\r\n    let addEventsToCalendar = () => {};\r\n\r\n    /**\r\n     * Apply style based on options\r\n     */\r\n    function applyStyleOptions() {\r\n      $('#content').toggleClass('hide-header', options.showHeader != '1');\r\n      $(':root').css('font-size', DEFAULT_FONT_SIZE * DEFAULT_FONT_SCALE);\r\n\r\n      options.mainBackgroundColor &&\r\n        $(':root').css('--main-background-color', options.mainBackgroundColor);\r\n\r\n      options.gridColor && $(':root').css('--grid-color', options.gridColor);\r\n      options.gridTextColor &&\r\n        $(':root').css('--grid-text-color', options.gridTextColor);\r\n\r\n      options.dayBgColor &&\r\n        $(':root').css('--day-bg-color', options.dayBgColor);\r\n      options.dayTextColor &&\r\n        $(':root').css('--day-text-color', options.dayTextColor);\r\n\r\n      options.todayTextColor &&\r\n        $(':root').css('--today-text-color', options.todayTextColor);\r\n\r\n      options.nowMarkerColor &&\r\n        $(':root').css('--now-marker-color', options.nowMarkerColor);\r\n\r\n      options.dayOtherMonthBgColor &&\r\n        $(':root').css(\r\n          '--day-other-month-bg-color',\r\n          options.dayOtherMonthBgColor,\r\n        );\r\n      options.dayOtherMonthTextColor &&\r\n        $(':root').css(\r\n          '--day-other-month-text-color',\r\n          options.dayOtherMonthTextColor,\r\n        );\r\n\r\n      options.headerBgColor &&\r\n        $(':root').css('--header-bg-color', options.headerBgColor);\r\n      options.headerTextColor &&\r\n        $(':root').css('--header-text-color', options.headerTextColor);\r\n\r\n      options.weekDaysHeaderBgColor &&\r\n        $(':root').css('--weekdays-bg-color', options.weekDaysHeaderBgColor);\r\n      options.weekDaysHeaderTextColor &&\r\n        $(':root').css(\r\n          '--weekdays-text-color',\r\n          options.weekDaysHeaderTextColor,\r\n        );\r\n\r\n      options.eventBgColor &&\r\n        $(':root').css('--event-bg-color', options.eventBgColor);\r\n      options.eventTextColor &&\r\n        $(':root').css('--event-text-color', options.eventTextColor);\r\n\r\n      options.dailyEventBgColor &&\r\n        $(':root').css('--daily-event-bg-color', options.dailyEventBgColor);\r\n      options.dailyEventTextColor &&\r\n        $(':root').css('--daily-event-text-color', options.dailyEventTextColor);\r\n\r\n      options.multiDayEventBgColor &&\r\n        $(':root').css(\r\n          '--multi-day-event-bg-color',\r\n          options.multiDayEventBgColor,\r\n        );\r\n      options.multiDayEventTextColor &&\r\n        $(':root').css(\r\n          '--multi-day-event-text-color',\r\n          options.multiDayEventTextColor,\r\n        );\r\n\r\n      options.aditionalEventsBgColor &&\r\n        $(':root').css(\r\n          '--aditional-events-bg-color',\r\n          options.aditionalEventsBgColor,\r\n        );\r\n      options.aditionalEventsTextColor &&\r\n        $(':root').css(\r\n          '--aditional-events-text-color',\r\n          options.aditionalEventsTextColor,\r\n        );\r\n\r\n      options.noEventsBgColor &&\r\n        $(':root').css(\r\n          '--no-events-bg-color',\r\n          options.noEventsBgColor,\r\n        );\r\n      options.noEventsTextColor &&\r\n        $(':root').css(\r\n          '--no-events-text-color',\r\n          options.noEventsTextColor,\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Get week day number by date\r\n     * @param {string} date date string\r\n     * @return {number} week day number\r\n     */\r\n    function getWeekday(date) {\r\n      return moment(date).weekday() + 1;\r\n    }\r\n\r\n    /**\r\n     * Create a marker showing current time\r\n     * @param {object} $container target container\r\n     * @param {object} timeData data with start and end dates for the view\r\n     */\r\n    function createNowMarker($container, timeData) {\r\n      const dayViewDuration = timeData.end - timeData.start;\r\n      const $nowMarker = $('<div class=\"now-marker\">');\r\n\r\n      const nowTimeInMinutes = moment\r\n        .duration(\r\n          moment(TODAY).diff(\r\n            moment(TODAY).startOf('day'),\r\n          ),\r\n        )\r\n        .as('minutes');\r\n\r\n      // Skip if it's not included in the selected delta time view\r\n      if (\r\n        nowTimeInMinutes >= timeData.end ||\r\n        nowTimeInMinutes <= timeData.start\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      // Calculate position\r\n      const eventPositionPerc = (\r\n        nowTimeInMinutes / dayViewDuration -\r\n        timeData.start / dayViewDuration\r\n      ) * 100;\r\n\r\n      $nowMarker.css(\r\n        'top',\r\n        eventPositionPerc + '%',\r\n      );\r\n\r\n      // Append marker to container\r\n      $nowMarker.appendTo($container);\r\n    }\r\n\r\n    /**\r\n     * Add events to calendar\r\n     */\r\n    function addEventsToCalendarBase() {\r\n      events.forEach((event) => {\r\n        const startDate = moment(event.startDate).startOf('date');\r\n\r\n        // Check if event is an all day\r\n        // (startDate 00:00 day 1, endDate 00:00 day after last day)\r\n        const allDayEvent =\r\n          moment(event.startDate).isSame(startDate) &&\r\n          moment(event.endDate).isSame(moment(event.endDate).startOf('date'));\r\n        event.allDay = allDayEvent;\r\n\r\n        const endDate = allDayEvent ?\r\n          moment(event.endDate).startOf('date').subtract(1, 'd') :\r\n          moment(event.endDate).startOf('date');\r\n\r\n        const eventTotalDays = endDate.diff(startDate, 'days') + 1;\r\n        let currentDayOfEvent = 1;\r\n\r\n        // Days loop\r\n        const momentAux = moment(startDate);\r\n        while (momentAux <= endDate) {\r\n          addEventToDay(momentAux, event, eventTotalDays, currentDayOfEvent);\r\n          currentDayOfEvent++;\r\n          momentAux.add(1, 'd');\r\n        }\r\n      });\r\n    }\r\n\r\n    /**\r\n       * Add event to specific day\r\n       * @param {object} date  momentjs date\r\n       * @param {object} event\r\n       * @param {number} eventTotalDays\r\n       * @param {number} currentDayOfEvent\r\n       */\r\n    function addEventToDay(date, event, eventTotalDays, currentDayOfEvent) {\r\n      /**\r\n       * Get container by date\r\n       * @param {object} date\r\n       * @return {object} Jquery container\r\n       */\r\n      function getEventContainer(date) {\r\n        return (options.calendarType == 2) ?\r\n          $('.calendar-day .calendar-events-container') :\r\n          $('#day_' + date.date()).find('.calendar-events-container');\r\n      }\r\n\r\n      /**\r\n       * Get all days container by date\r\n       * @param {object} date\r\n       * @return {object} Jquery container\r\n       */\r\n      function getAllDayEventsContainer(date) {\r\n        return (options.calendarType == 2) ?\r\n          $('.calendar-day .calendar-all-day-events-container') :\r\n          $('#day_' + date.date()).find('.calendar-all-day-events-container');\r\n      }\r\n\r\n      const $newEvent = $('<div class=\"calendar-event\">');\r\n      const weekDay = getWeekday(date);\r\n      let eventDuration = 1;\r\n\r\n      // Mark event as an all day\r\n      if (event.allDay) {\r\n        $newEvent.addClass('all-day');\r\n      }\r\n\r\n      if (eventTotalDays > 1) {\r\n        // Multiple day event\r\n        let htmlToAdd =\r\n          '<span class=\"event-summary\">' + event.summary + '</span>';\r\n\r\n        // Mark as multi event\r\n        $newEvent.addClass('multi-day');\r\n\r\n        // Draw only on the first day of the event\r\n        // or at the beggining of the weeks when it breaks\r\n        if (currentDayOfEvent == 1 || weekDay == 1) {\r\n          if (currentDayOfEvent == 1 && !event.allDay) {\r\n            htmlToAdd =\r\n              '<div class=\"event-time\">' +\r\n              moment(event.startDate).format(TIME_FORMAT) +\r\n              '</div>' +\r\n              htmlToAdd;\r\n          }\r\n\r\n          // Show event content in multiple days\r\n          $newEvent.html(htmlToAdd);\r\n\r\n          // Update element duration based on event duration\r\n          eventDuration = eventTotalDays - (currentDayOfEvent - 1);\r\n\r\n          const remainingDays = 8 - weekDay;\r\n          if (eventDuration > remainingDays) {\r\n            eventDuration = remainingDays;\r\n            $newEvent.addClass('cropped-event-end');\r\n          }\r\n\r\n          if (currentDayOfEvent > 1) {\r\n            $newEvent.addClass('cropped-event-start');\r\n          }\r\n          $newEvent.css(\r\n            'width',\r\n            'calc(' +\r\n            eventDuration * 100 +\r\n            '% + ' +\r\n            eventDuration * 2 +\r\n            'px)',\r\n          );\r\n        } else {\r\n          // Multiple event that was extended, no need to be rendered\r\n          return;\r\n        }\r\n      } else {\r\n        // Single day event\r\n        let htmlToAdd =\r\n          '<div class=\"event-summary\">' + event.summary + '</div>';\r\n\r\n        // Mark event as an all day\r\n        if (event.allDay) {\r\n          $newEvent.addClass('all-day');\r\n        } else {\r\n          htmlToAdd =\r\n            htmlToAdd +\r\n            '<div class=\"event-time\">' +\r\n            moment(event.startDate).format(TIME_FORMAT) +\r\n            ' - ' +\r\n            moment(event.endDate).format(TIME_FORMAT) +\r\n            '</div>';\r\n        }\r\n\r\n        // Add inner html\r\n        $newEvent.html(htmlToAdd);\r\n      }\r\n\r\n      // All day or multi day events\r\n      if (eventTotalDays > 1 || event.allDay) {\r\n        // If there's at least one daily event\r\n        // enable the container in the calendar view\r\n        $('.calendar-container').addClass('show-all-day-events');\r\n\r\n        const $dailyEventsContainer = getAllDayEventsContainer(date);\r\n\r\n        // Calculate event slot\r\n        let slots = $dailyEventsContainer.data('slots');\r\n        let daySlot;\r\n        if (slots != undefined) {\r\n          for (let index = 0; index < slots.length; index++) {\r\n            const slot = slots[index];\r\n            if (slot === undefined) {\r\n              daySlot = index;\r\n              slots[index] = 1;\r\n              break;\r\n            }\r\n          }\r\n\r\n          if (daySlot === undefined) {\r\n            daySlot = slots.length;\r\n            slots.push(1);\r\n          }\r\n        } else {\r\n          daySlot = 0;\r\n          slots = [1];\r\n        }\r\n\r\n        $dailyEventsContainer.data('slots', slots);\r\n\r\n        // Extend event to the remaining days\r\n        if (eventDuration > 1 && options.calendarType != 2) {\r\n          for (let dayAfter = 1; dayAfter < eventDuration; dayAfter++) {\r\n            const $newContainer = getAllDayEventsContainer(\r\n              moment(date).add(dayAfter, 'd'),\r\n            );\r\n            let dataSlots = $newContainer.data('slots');\r\n\r\n            if (dataSlots === undefined) {\r\n              dataSlots = [];\r\n            }\r\n\r\n            dataSlots[daySlot] = 2;\r\n            $newContainer.data('slots', dataSlots);\r\n          }\r\n        }\r\n\r\n        $newEvent.css('top', 1.875 * daySlot + 'rem');\r\n\r\n        // Append event to container\r\n        $newEvent.appendTo($dailyEventsContainer);\r\n\r\n        // Check container height and slots to show number of extra events\r\n        updateContainerExtraEvents($dailyEventsContainer, slots);\r\n      } else {\r\n        // Daily timed event\r\n        const $eventsContainer = getEventContainer(date);\r\n        const containerData = $('.hour-grid').data();\r\n\r\n        const dayViewDuration = containerData.end - containerData.start;\r\n        const eventData = {\r\n          start: moment\r\n            .duration(\r\n              moment(event.startDate).diff(\r\n                moment(event.startDate).startOf('day'),\r\n              ),\r\n            )\r\n            .as('minutes'),\r\n          duration: moment\r\n            .duration(moment(event.endDate).diff(moment(event.startDate)))\r\n            .as('minutes'),\r\n        };\r\n\r\n        // Skip event if it's not included in the selected delta time view\r\n        if (\r\n          eventData.start >= containerData.end ||\r\n          eventData.start + eventData.duration <= containerData.start\r\n        ) {\r\n          return;\r\n        }\r\n\r\n        // Calculate position\r\n        let eventPositionPerc = (\r\n          eventData.start / dayViewDuration -\r\n          containerData.start / dayViewDuration\r\n        ) * 100;\r\n        let eventHeightAdj = 0;\r\n\r\n        // Check if event starts before view time\r\n        if (eventPositionPerc < 0) {\r\n          $newEvent.addClass('before-view');\r\n          eventHeightAdj = eventPositionPerc;\r\n          eventPositionPerc = 0;\r\n        }\r\n\r\n        $newEvent.css(\r\n          'top',\r\n          eventPositionPerc + '%',\r\n        );\r\n\r\n        // Calculate event slot\r\n        let slots = $eventsContainer.data('slots');\r\n        let eventLevel = 0;\r\n        if (slots != undefined) {\r\n          let newLevel = 0;\r\n          for (let index = 0; index < slots.length; index++) {\r\n            const slot = slots[index];\r\n            if (\r\n              !(\r\n                eventData.start >= slot.end ||\r\n                eventData.start + eventData.duration <= slot.start\r\n              )\r\n            ) {\r\n              newLevel = slot.level + 1;\r\n            }\r\n          }\r\n\r\n          slots.push({\r\n            level: newLevel,\r\n            start: eventData.start,\r\n            end: eventData.start + eventData.duration,\r\n          });\r\n\r\n          eventLevel = newLevel;\r\n        } else {\r\n          slots = [\r\n            {\r\n              level: 0,\r\n              start: eventData.start,\r\n              end: eventData.start + eventData.duration,\r\n            },\r\n          ];\r\n\r\n          eventLevel = 0;\r\n        }\r\n\r\n        // Update container slots\r\n        $eventsContainer.data('slots', slots);\r\n\r\n        // Assign level\r\n        $newEvent.addClass('level-' + eventLevel);\r\n        $newEvent.toggleClass('concurrent', eventLevel > 0);\r\n\r\n        // Calculate height\r\n        const eventHeight = ((eventData.duration / dayViewDuration) * 100) +\r\n          eventHeightAdj;\r\n\r\n        $newEvent.height(eventHeight + '%');\r\n\r\n        // Append event to container\r\n        $newEvent.appendTo($eventsContainer);\r\n\r\n        // Mark shorter events to be styled\r\n        if ($newEvent.height() < parseFloat($newEvent.css('font-size')) * 2) {\r\n          $newEvent.addClass('shorter-event');\r\n          $newEvent.find('.event-time').prependTo($newEvent);\r\n        }\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Update container and hide the number of extra events\r\n     * @param {object} $container jquery container\r\n     * @param {object} slots occupied slots\r\n     */\r\n    function updateContainerExtraEvents($container, slots) {\r\n      // Calculate max events per container (if not defined)\r\n      if (!maxEventPerDay) {\r\n        const bodyFontSize = parseInt(\r\n          $('body').css('font-size').split('px')[0],\r\n        );\r\n        const singleEventHeight =\r\n          bodyFontSize * 1.25 + bodyFontSize * 0.5 + bodyFontSize * 0.125;\r\n        const extraEventsHeight = bodyFontSize * 1.25 + bodyFontSize * 0.125;\r\n        maxEventPerDay = Math.floor($container.height() / singleEventHeight);\r\n\r\n        maxEventPerDayWithExtra = Math.floor(\r\n          ($container.height() - extraEventsHeight) / singleEventHeight,\r\n        );\r\n      }\r\n\r\n      // If we show extra. get number of events\r\n      // that fit inside that space ( smaller )\r\n      let maxEventsForThisDay = maxEventPerDay;\r\n      if (slots.length > maxEventPerDay) {\r\n        maxEventsForThisDay = maxEventPerDayWithExtra;\r\n      }\r\n\r\n      // Get number of dummy events that were generated\r\n      // by extended events in the visible elements\r\n      const numberOfExtendedEvents = slots.filter((ev, idx) => {\r\n        return ev == 2 && idx <= maxEventsForThisDay;\r\n      }).length;\r\n\r\n      // Remove extra elements\r\n      if (\r\n        maxEventsForThisDay > 0 &&\r\n        maxEventsForThisDay > numberOfExtendedEvents\r\n      ) {\r\n        $container\r\n          .find(\r\n            '.calendar-event:gt(' +\r\n            (maxEventsForThisDay - numberOfExtendedEvents - 1) +\r\n            ')',\r\n          )\r\n          .remove();\r\n      } else {\r\n        $container.find('.calendar-event').remove();\r\n      }\r\n\r\n      // Calculate number of events that were hidden\r\n      let numEventsToHide = 0;\r\n      for (let index = maxEventsForThisDay; index < slots.length; index++) {\r\n        if (slots[index] != undefined) {\r\n          numEventsToHide++;\r\n        }\r\n      }\r\n\r\n      // Fix for extended events\r\n      let numExtendedEventsFix = 0;\r\n      if (maxEventsForThisDay > 0 &&\r\n        maxEventsForThisDay < numberOfExtendedEvents) {\r\n        numExtendedEventsFix = numberOfExtendedEvents - maxEventsForThisDay;\r\n      }\r\n      numEventsToHide -= numExtendedEventsFix;\r\n\r\n      // Update extra events label\r\n      if (numEventsToHide > 0) {\r\n        if ($container.find('.extra-events').length > 0) {\r\n          $container.find('.extra-events span').html('+ ' + numEventsToHide);\r\n        } else {\r\n          $container.append(\r\n            '<div class=\"extra-events\"><span>+ ' +\r\n            numEventsToHide +\r\n            '</span></div>',\r\n          );\r\n        }\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Create hour grid\r\n     * @param {object} $container jquery container\r\n     * @param {string} start\r\n     * @param {string} end\r\n     */\r\n    function createCalendarHourGrid($container, start, end) {\r\n      start =\r\n        start == '' ?\r\n          moment(DEFAULT_DAY_START_TIME, TIME_FORMAT) :\r\n          moment(start, TIME_FORMAT);\r\n      end =\r\n        end == '' ?\r\n          moment(DEFAULT_DAY_END_TIME, TIME_FORMAT) :\r\n          moment(end, TIME_FORMAT);\r\n\r\n      // Hour loop\r\n      const momentAux = moment(start);\r\n      while (momentAux <= end) {\r\n        $container.append(\r\n          '<li class=\"hour-time\">' + momentAux.format(TIME_FORMAT) + '</li>',\r\n        );\r\n        momentAux.add(GRID_STEP, 'm');\r\n      }\r\n\r\n      // Save properties to the container for later use\r\n      const containerData = {\r\n        start: moment\r\n          .duration(moment(start).diff(moment(start).startOf('day')))\r\n          .as('minutes'),\r\n        end: moment\r\n          .duration(moment(end).diff(moment(end).startOf('day')))\r\n          .as('minutes'),\r\n      };\r\n      $container.data(containerData);\r\n\r\n      // Calculate hour grid spacing\r\n      const gridSpacing =\r\n        (1 / ((containerData.end - containerData.start) / GRID_STEP)) * 100;\r\n      $container.find('.hour-time').height(gridSpacing + '%');\r\n    }\r\n\r\n    // Functions by calendar type\r\n    if (options.calendarType == 1) {\r\n      // Schedule View\r\n      const $calendarContainer = $('.calendar-container');\r\n      let addedEvents = 0;\r\n\r\n      /**\r\n       * Add event to specific day (override)\r\n       * @param {object} date  momentjs date\r\n       * @param {object} event\r\n       * @param {number} eventTotalDays\r\n       * @param {number} currentDayOfEvent\r\n       */\r\n      function addEventToDay(date, event, eventTotalDays, currentDayOfEvent) {\r\n        /**\r\n         * Get container by date\r\n         * @param {object} date\r\n         * @return {object} Jquery container\r\n         */\r\n        function getDayContainer(date) {\r\n          let $dayContainerTemp;\r\n          let $dayContainerTitle;\r\n\r\n          if ($('#day_' + date.month() + '_' + date.date()).length > 0) {\r\n            $dayContainerTemp = $('#day_' + date.month() + '_' + date.date());\r\n          } else {\r\n            $dayContainerTemp = $('<div>').attr('id', 'day_' +\r\n              date.month() + '_' + date.date()).addClass('day-container');\r\n\r\n            $dayContainerTitle = $('<div class=\"title-container\">').appendTo(\r\n              $dayContainerTemp);\r\n\r\n            if (moment(date).startOf('d').isSame(moment(TODAY).startOf('d'))) {\r\n              $dayContainerTemp.addClass('today');\r\n            }\r\n\r\n            $('<div class=\"day-title-date\">' +\r\n              date.date() +\r\n              '</div>').appendTo($dayContainerTitle);\r\n\r\n            $('<div class=\"day-title-month\">' +\r\n              monthsNames[date.month()] +\r\n                '</div>').appendTo($dayContainerTitle);\r\n\r\n            $('<div class=\"day-title-weekday\">' +\r\n              weekdaysNames[date.weekday()] +\r\n              '</div>').appendTo($dayContainerTitle);\r\n\r\n            $('<div class=\"day-events\">').appendTo($dayContainerTemp);\r\n\r\n            $dayContainerTemp.appendTo($calendarContainer);\r\n          }\r\n\r\n          // $calendarContainer\r\n          return $dayContainerTemp;\r\n        }\r\n\r\n        const $newEvent = $('<div class=\"calendar-event\">');\r\n        const $dayContainer = getDayContainer(date);\r\n        const $dayContainerEvents = $dayContainer.find('.day-events');\r\n        let htmlToAdd = '';\r\n\r\n        // Add time\r\n        if (!event.allDay) {\r\n          if (currentDayOfEvent == 1) {\r\n            htmlToAdd +=\r\n              '<span class=\"event-start-time\">' +\r\n                moment(event.startDate).format(TIME_FORMAT) +\r\n              '</span>';\r\n\r\n            // Save start date to object data\r\n            $newEvent.data('start', event.startDate);\r\n\r\n            if (eventTotalDays == 1) {\r\n              htmlToAdd +=\r\n                ' - <span class=\"event-end-time\">' +\r\n                  moment(event.endDate).format(TIME_FORMAT) +\r\n                '</span>';\r\n            }\r\n          }\r\n        } else {\r\n          // Mark event as an all day\r\n          $newEvent.addClass('all-day');\r\n        }\r\n\r\n        // Mark event as a multi-day\r\n        if (eventTotalDays > 1) {\r\n          $newEvent.addClass('multi');\r\n        }\r\n\r\n        // Add summary\r\n        htmlToAdd += '<span class=\"event-summary\">' + event.summary + '</span>';\r\n\r\n        if (options.showDescription == 1 && event.description) {\r\n          htmlToAdd += '<div class=\"event-description\">' +\r\n            event.description + '</div>';\r\n        }\r\n\r\n        // Add inner html\r\n        $newEvent.html(htmlToAdd);\r\n\r\n        // Append event to container\r\n        if (event.allDay) {\r\n          $newEvent.prependTo($dayContainerEvents);\r\n        } else {\r\n          $newEvent.appendTo($dayContainerEvents);\r\n        }\r\n\r\n        addedEvents++;\r\n      }\r\n\r\n      // Override addEventsToCalendarBase\r\n      addEventsToCalendar = function(events) {\r\n        events.forEach((event) => {\r\n          const startDate = moment(event.startDate).startOf('date');\r\n\r\n          // Check if event is an all day\r\n          // (startDate 00:00 day 1, endDate 00:00 day after last day)\r\n          const allDayEvent =\r\n            moment(event.startDate).isSame(startDate) &&\r\n            moment(event.endDate).isSame(moment(event.endDate).startOf('date'));\r\n          event.allDay = allDayEvent;\r\n\r\n          const endDate = allDayEvent ?\r\n            moment(event.endDate).startOf('date').subtract(1, 'd') :\r\n            moment(event.endDate).startOf('date');\r\n\r\n          const eventTotalDays = endDate.diff(startDate, 'days') + 1;\r\n          let currentDayOfEvent = 1;\r\n\r\n          // Days loop\r\n          const momentAux = moment(startDate);\r\n\r\n          while (momentAux <= endDate) {\r\n            let startDate = null;\r\n            let endDate = null;\r\n\r\n            // If we're using a date range\r\n            // show only events from the start date onwards\r\n            // and before the end date\r\n            if (options.useDateRange == 1) {\r\n              (options.rangeStart) && (startDate = moment(options.rangeStart));\r\n              (options.rangeEnd) && (endDate = moment(options.rangeEnd));\r\n            } else {\r\n              startDate = TODAY.startOf('d');\r\n            }\r\n\r\n            // Add event\r\n            if ((!startDate || momentAux >= startDate) &&\r\n              (!endDate || momentAux <= endDate)) {\r\n              addEventToDay(\r\n                momentAux,\r\n                event,\r\n                eventTotalDays,\r\n                currentDayOfEvent);\r\n            }\r\n\r\n            currentDayOfEvent++;\r\n            momentAux.add(1, 'd');\r\n          }\r\n        });\r\n\r\n        // Create now marker\r\n        if (options.showNowMarker == 1) {\r\n          const $nowMarker = $('<div class=\"now-marker\">');\r\n          const $dayEventsContainer = $calendarContainer.find('#day_' +\r\n            moment(TODAY).month() + '_' + moment(TODAY).date() +\r\n            ' .day-events');\r\n          let $targetElement;\r\n\r\n          if ($dayEventsContainer.length > 0) {\r\n            // Calculate position\r\n            $dayEventsContainer.find('.calendar-event').each((idx, event) => {\r\n              const start = $(event).data('start');\r\n\r\n              if (start && TODAY < moment(start)) {\r\n                $targetElement = $(event);\r\n                $nowMarker.insertBefore($targetElement);\r\n                return false;\r\n              }\r\n            });\r\n\r\n            // Append marker to container\r\n            if (!$targetElement) {\r\n              $nowMarker.appendTo($dayEventsContainer);\r\n            }\r\n          }\r\n        }\r\n\r\n        // Show no events message\r\n        if (options.noEventsMessage != '' && addedEvents == 0) {\r\n          $calendarContainer.append('<div class=\"no-events-message\">' +\r\n            options.noEventsMessage + '</div>');\r\n        }\r\n        // noEventsMessage\r\n      };\r\n    } else if (options.calendarType == 2) {\r\n      // Daily View\r\n      const $hourGrid = $('.hour-grid');\r\n      const $dayTitle = $('.day-title');\r\n      const $dayContainer = $('.day-container');\r\n\r\n      createCalendar = function() {\r\n        // Add day label\r\n        const $weekDay = $('<li>');\r\n        $dayTitle.append($weekDay);\r\n        $weekDay.html('<div class=\"week-day\">' +\r\n          weekdaysNames[TODAY.weekday()] +\r\n          '</div>');\r\n\r\n        const today = moment(TODAY);\r\n        const day = {\r\n          date: today.format('YYYY-MM-DD'),\r\n          dayOfMonth: today.date(),\r\n        };\r\n\r\n        const $dayOfMonthElement = $('<div class=\"week-day-date\">');\r\n        $dayOfMonthElement.html(day.dayOfMonth);\r\n        $weekDay.append($dayOfMonthElement);\r\n\r\n        // Add hour grid\r\n        createCalendarHourGrid($hourGrid, options.startTime, options.endTime);\r\n\r\n        // Add day element\r\n        const $dayElement = $('<li id=\"day_' + day.dayOfMonth + '\">');\r\n        $dayElement.addClass('calendar-day');\r\n\r\n        // Append all day events container\r\n        $dayElement.append(\r\n          $('<div class=\"calendar-all-day-events-container\">'),\r\n        );\r\n\r\n        // Append normal events container\r\n        $dayElement.append($('<div class=\"calendar-events-container\">'));\r\n\r\n        // Append day to container\r\n        $dayContainer.append($dayElement);\r\n\r\n        if (options.showNowMarker == 1) {\r\n          createNowMarker(\r\n            $dayElement.find('.calendar-events-container'),\r\n            $('.hour-grid').data(),\r\n          );\r\n        }\r\n      };\r\n\r\n      addEventsToCalendar = addEventsToCalendarBase;\r\n    } else if (options.calendarType == 3) {\r\n      // Weekly View\r\n      const $daysOfWeek = $('.day-of-week');\r\n      const $calendarDays = $('.days-row');\r\n      const $hourGrid = $('.hour-grid');\r\n\r\n      createCalendar = function() {\r\n        const year = INITIAL_YEAR;\r\n        const month = INITIAL_MONTH;\r\n        const date = INITIAL_DATE;\r\n\r\n        weekdaysNames.forEach((weekday, idx) => {\r\n          const $weekDay = $('<li id=\"' + idx + '\">');\r\n          $daysOfWeek.append($weekDay);\r\n          $weekDay.html('<div class=\"week-day\">' + weekday + '</div>');\r\n        });\r\n\r\n        // Add hour grid\r\n        createCalendarHourGrid($hourGrid, options.startTime, options.endTime);\r\n\r\n        // Remove all days\r\n        $calendarDays.find('.calendar-day').remove();\r\n\r\n        currentWeekDays = createDaysForCurrentWeek(year, month, date);\r\n\r\n        currentWeekDays.forEach((day) => {\r\n          appendDay(day, $calendarDays);\r\n        });\r\n      };\r\n\r\n      /**\r\n       * Create days for current week\r\n       * @param {string} year\r\n       * @param {string} month\r\n       * @param {string} date\r\n       * @return {array} Days of the week\r\n       */\r\n      function createDaysForCurrentWeek(year, month, date) {\r\n        const startOfWeek = moment({\r\n          year: year,\r\n          month: month,\r\n          date: date,\r\n        }).startOf('week');\r\n\r\n        return [...Array(7)].map((day, index) => {\r\n          const weekDay = moment(startOfWeek).add(index, 'd');\r\n          return {\r\n            date: weekDay.format('YYYY-MM-DD'),\r\n            dayOfMonth: weekDay.date(),\r\n            dayOfWeek: index,\r\n          };\r\n        });\r\n      }\r\n\r\n      /**\r\n       * Append new day\r\n       * @param {object} day\r\n       * @param {object} $calendarDays\r\n       */\r\n      function appendDay(day, $calendarDays) {\r\n        const $daysOfWeek = $('.day-of-week');\r\n        const $dayElement = $('<li id=\"day_' + day.dayOfMonth + '\">');\r\n        $dayElement.addClass('calendar-day');\r\n\r\n        // Append all day events container\r\n        $dayElement.append(\r\n          $('<div class=\"calendar-all-day-events-container\">'),\r\n        );\r\n\r\n        // Append normal events container\r\n        $dayElement.append($('<div class=\"calendar-events-container\">'));\r\n\r\n        // Append week day name element\r\n        const $dayOfMonthElement = $('<div class=\"week-day-date\">');\r\n        $dayOfMonthElement.html(day.dayOfMonth);\r\n        $daysOfWeek.find('#' + day.dayOfWeek).append($dayOfMonthElement);\r\n\r\n        $calendarDays.append($dayElement);\r\n\r\n        if (day.date === moment(TODAY).format('YYYY-MM-DD')) {\r\n          $daysOfWeek.find('#' + day.dayOfWeek).addClass('day-of-week--today');\r\n\r\n          if (options.showNowMarker == 1) {\r\n            createNowMarker(\r\n              $dayElement.find('.calendar-events-container'),\r\n              $('.hour-grid').data(),\r\n            );\r\n          }\r\n        }\r\n      }\r\n\r\n      // Override addEventsToCalendarBase\r\n      addEventsToCalendar = function(events) {\r\n        events.forEach((event) => {\r\n          const startDate = moment(event.startDate).startOf('date');\r\n\r\n          // Check if event is an all day\r\n          // (startDate 00:00 day 1, endDate 00:00 day after last day)\r\n          const allDayEvent =\r\n            moment(event.startDate).isSame(startDate) &&\r\n            moment(event.endDate).isSame(moment(event.endDate).startOf('date'));\r\n          event.allDay = allDayEvent;\r\n\r\n          const endDate = allDayEvent ?\r\n            moment(event.endDate).startOf('date').subtract(1, 'd') :\r\n            moment(event.endDate).startOf('date');\r\n\r\n          const eventTotalDays = endDate.diff(startDate, 'days') + 1;\r\n          let currentDayOfEvent = 1;\r\n\r\n          // Days loop\r\n          const momentAux = moment(startDate);\r\n          while (momentAux <= endDate) {\r\n            addEventToDay(momentAux, event, eventTotalDays, currentDayOfEvent);\r\n            currentDayOfEvent++;\r\n            momentAux.add(1, 'd');\r\n          }\r\n        });\r\n      };\r\n    } else if (options.calendarType == 4) {\r\n      // Monthly View\r\n      let currentMonthDays;\r\n      let previousMonthDays;\r\n      let nextMonthDays;\r\n\r\n      createCalendar = function() {\r\n        const $calendarDays = $('#calendarDays');\r\n        const year = INITIAL_YEAR;\r\n        const month = INITIAL_MONTH;\r\n        const $daysOfWeek = $('#daysOfWeek');\r\n\r\n        weekdaysNames.forEach((weekday) => {\r\n          const $weekDay = $('<li>');\r\n          $daysOfWeek.append($weekDay);\r\n          $weekDay.html(weekday);\r\n        });\r\n\r\n        $('#selectedMonth').html(\r\n          moment({\r\n            year: year,\r\n            month: month,\r\n          }).format('MMMM YYYY'),\r\n        );\r\n\r\n        // Remove all days\r\n        $calendarDays.find('.calendar-day').remove();\r\n\r\n        currentMonthDays = createDaysForCurrentMonth(year, month);\r\n\r\n        previousMonthDays = createDaysForPreviousMonth(year, month - 1);\r\n        nextMonthDays = createDaysForNextMonth(year, month + 1);\r\n\r\n        const days = [\r\n          ...previousMonthDays,\r\n          ...currentMonthDays,\r\n          ...nextMonthDays,\r\n        ];\r\n\r\n        days.forEach((day) => {\r\n          appendDay(day, $calendarDays);\r\n        });\r\n      };\r\n\r\n      /**\r\n       * Append new day\r\n       * @param {object} day\r\n       * @param {object} $calendarDays\r\n       */\r\n      function appendDay(day, $calendarDays) {\r\n        const $dayElement = $(\r\n          '<li id=\"day_' + day.month + '_' + day.dayOfMonth + '\">',\r\n        );\r\n        $dayElement.addClass('calendar-day');\r\n\r\n        // Append events container\r\n        const $eventsContainer = $('<div class=\"calendar-events-container\">');\r\n        $dayElement.append($eventsContainer);\r\n\r\n        // Append day\r\n        const $dayOfMonthElement = $('<span class=\"date\">');\r\n        $dayOfMonthElement.html(day.dayOfMonth);\r\n        $dayElement.append($dayOfMonthElement);\r\n\r\n        $calendarDays.append($dayElement);\r\n\r\n        if (!day.isCurrentMonth) {\r\n          $dayElement.addClass('calendar-day--not-current');\r\n        }\r\n\r\n        if (day.date === moment(TODAY).format('YYYY-MM-DD')) {\r\n          $dayElement.addClass('calendar-day--today');\r\n        }\r\n      }\r\n\r\n      /**\r\n       * Get the number of days in a given month\r\n       * @param {number} year\r\n       * @param {number} month\r\n       * @return {array} day objects\r\n       */\r\n      function getNumberOfDaysInMonth(year, month) {\r\n        return moment({\r\n          year: year,\r\n          month: month,\r\n        }).daysInMonth();\r\n      }\r\n\r\n      /**\r\n       * Create days on current month\r\n       * @param {number} year\r\n       * @param {number} month\r\n       * @return {array} day objects\r\n       */\r\n      function createDaysForCurrentMonth(year, month) {\r\n        return [...Array(getNumberOfDaysInMonth(year, month))].map(\r\n          (day, index) => {\r\n            return {\r\n              date: moment({\r\n                year: year,\r\n                month: month,\r\n                day: index + 1,\r\n              }).format('YYYY-MM-DD'),\r\n              dayOfMonth: index + 1,\r\n              month: month,\r\n              isCurrentMonth: true,\r\n            };\r\n          },\r\n        );\r\n      }\r\n\r\n      /**\r\n       * Create days in previous month\r\n       * @param {number} year\r\n       * @param {number} month\r\n       * @return {array} day objects\r\n       */\r\n      function createDaysForPreviousMonth(year, month) {\r\n        const firstDayOfTheMonthWeekday = getWeekday(currentMonthDays[0].date);\r\n\r\n        const previousMonth = moment({\r\n          year: year,\r\n          month: month - 1,\r\n        });\r\n\r\n        // Cover first day of the month\r\n        //  being sunday (firstDayOfTheMonthWeekday === 0)\r\n        const visibleNumberOfDaysFromPreviousMonth = firstDayOfTheMonthWeekday ?\r\n          firstDayOfTheMonthWeekday - 1 :\r\n          6;\r\n\r\n        const previousMonthLastMondayDayOfMonth = moment(\r\n          currentMonthDays[0].date,\r\n        )\r\n          .subtract(visibleNumberOfDaysFromPreviousMonth, 'day')\r\n          .date();\r\n\r\n        return [...Array(visibleNumberOfDaysFromPreviousMonth)].map(\r\n          (day, index) => {\r\n            return {\r\n              date: moment({\r\n                year: previousMonth.year(),\r\n                month: previousMonth.month(),\r\n                day: previousMonthLastMondayDayOfMonth + index,\r\n              }).format('YYYY-MM-DD'),\r\n              month: previousMonth.month(),\r\n              dayOfMonth: previousMonthLastMondayDayOfMonth + index,\r\n              isCurrentMonth: false,\r\n            };\r\n          },\r\n        );\r\n      }\r\n\r\n      /**\r\n       * Create days in next month\r\n       * @param {number} year\r\n       * @param {number} month\r\n       * @return {array} day objects\r\n       */\r\n      function createDaysForNextMonth(year, month) {\r\n        const lastDayOfTheMonthWeekday = getWeekday({\r\n          year: year,\r\n          month: month - 1,\r\n          date: currentMonthDays.length,\r\n        });\r\n\r\n        const nextMonth = moment({\r\n          year: year,\r\n          month: month,\r\n        });\r\n\r\n        const visibleNumberOfDaysFromNextMonth = lastDayOfTheMonthWeekday ?\r\n          7 - lastDayOfTheMonthWeekday :\r\n          lastDayOfTheMonthWeekday;\r\n\r\n        return [...Array(visibleNumberOfDaysFromNextMonth)].map(\r\n          (day, index) => {\r\n            return {\r\n              date: moment({\r\n                year: nextMonth.year(),\r\n                month: nextMonth.month(),\r\n                day: index + 1,\r\n              }).format('YYYY-MM-DD'),\r\n              month: nextMonth.month(),\r\n              dayOfMonth: index + 1,\r\n              isCurrentMonth: false,\r\n            };\r\n          },\r\n        );\r\n      }\r\n\r\n      addEventsToCalendar = function(events) {\r\n        events.forEach((event) => {\r\n          const startDate = moment(event.startDate).startOf('date');\r\n\r\n          // Check if event is an all day\r\n          // (startDate 00:00 day 1, endDate 00:00 day after last day)\r\n          const allDayEvent =\r\n            moment(event.startDate).isSame(startDate) &&\r\n            moment(event.endDate).isSame(moment(event.endDate).startOf('date'));\r\n          event.allDay = allDayEvent;\r\n\r\n          const endDate = allDayEvent ?\r\n            moment(event.endDate).startOf('date').subtract(1, 'd') :\r\n            moment(event.endDate).startOf('date');\r\n\r\n          const eventTotalDays = endDate.diff(startDate, 'days') + 1;\r\n\r\n          // Days loop\r\n          let currentDayOfEvent = 1;\r\n          const momentAux = moment(startDate);\r\n          while (momentAux <= endDate) {\r\n            addEventToDay(momentAux, event, eventTotalDays, currentDayOfEvent);\r\n            currentDayOfEvent++;\r\n            momentAux.add(1, 'd');\r\n          }\r\n        });\r\n      };\r\n\r\n      /**\r\n       * Add event to specific day (override)\r\n       * @param {object} date  momentjs date\r\n       * @param {object} event\r\n       * @param {number} eventTotalDays\r\n       * @param {number} currentDayOfEvent\r\n       */\r\n      function addEventToDay(date, event, eventTotalDays, currentDayOfEvent) {\r\n        /**\r\n         * Get container by date\r\n         * @param {object} date\r\n         * @return {object} Jquery container\r\n         */\r\n        function getEventContainer(date) {\r\n          return $('#day_' + date.month() + '_' + date.date()).find(\r\n            '.calendar-events-container',\r\n          );\r\n        }\r\n\r\n        const $newEvent = $('<div class=\"calendar-event\">');\r\n        const $eventsContainer = getEventContainer(date);\r\n        const weekDay = getWeekday(date);\r\n        let eventDuration = 1;\r\n\r\n        // Mark event as an all day\r\n        if (event.allDay) {\r\n          $newEvent.addClass('all-day');\r\n        }\r\n\r\n        if (eventTotalDays > 1) {\r\n          // Multiple day event\r\n          let htmlToAdd =\r\n            '<span class=\"event-summary\">' + event.summary + '</span>';\r\n\r\n          // Mark as multi event\r\n          $newEvent.addClass('multi-day');\r\n\r\n          // Draw only on the first day of the event\r\n          // or at the beggining of the weeks when it breaks\r\n          if (currentDayOfEvent == 1 || weekDay == 1) {\r\n            if (currentDayOfEvent == 1 && !event.allDay) {\r\n              htmlToAdd =\r\n                '<span class=\"event-time\">' +\r\n                moment(event.startDate).format(TIME_FORMAT) +\r\n                '</span>' +\r\n                htmlToAdd;\r\n            }\r\n\r\n            // Show event content in multiple days\r\n            $newEvent.html(htmlToAdd);\r\n\r\n            // Update element duration based on event duration\r\n            eventDuration = eventTotalDays - (currentDayOfEvent - 1);\r\n\r\n            const remainingDays = 8 - weekDay;\r\n            if (eventDuration > remainingDays) {\r\n              eventDuration = remainingDays;\r\n              $newEvent.addClass('cropped-event-end');\r\n            }\r\n\r\n            if (currentDayOfEvent > 1) {\r\n              $newEvent.addClass('cropped-event-start');\r\n            }\r\n            $newEvent.css(\r\n              'width',\r\n              'calc(' +\r\n              eventDuration * 100 +\r\n              '% + ' +\r\n              eventDuration * 2 +\r\n              'px)',\r\n            );\r\n          } else {\r\n            // Multiple event that was extended, no need to be rendered\r\n            return;\r\n          }\r\n        } else {\r\n          // Single day event\r\n          let htmlToAdd =\r\n            '<span class=\"event-summary\">' + event.summary + '</span>';\r\n\r\n          // Mark event as an all day\r\n          if (event.allDay) {\r\n            $newEvent.addClass('all-day');\r\n          } else {\r\n            htmlToAdd =\r\n              '<span class=\"event-time\">' +\r\n              moment(event.startDate).format(TIME_FORMAT) +\r\n              '</span>' +\r\n              htmlToAdd;\r\n          }\r\n\r\n          // Add inner html\r\n          $newEvent.html(htmlToAdd);\r\n        }\r\n\r\n        // Calculate event slot\r\n        let slots = $eventsContainer.data('slots');\r\n        let daySlot;\r\n        if (slots != undefined) {\r\n          for (let index = 0; index < slots.length; index++) {\r\n            const slot = slots[index];\r\n            if (slot === undefined) {\r\n              daySlot = index;\r\n              slots[index] = 1;\r\n              break;\r\n            }\r\n          }\r\n\r\n          if (daySlot === undefined) {\r\n            daySlot = slots.length;\r\n            slots.push(1);\r\n          }\r\n        } else {\r\n          daySlot = 0;\r\n          slots = [1];\r\n        }\r\n\r\n        $eventsContainer.data('slots', slots);\r\n\r\n        // Extend event to the remaining days\r\n        if (eventDuration > 1) {\r\n          for (let dayAfter = 1; dayAfter < eventDuration; dayAfter++) {\r\n            const $newContainer = getEventContainer(\r\n              moment(date).add(dayAfter, 'd'),\r\n            );\r\n            let dataSlots = $newContainer.data('slots');\r\n\r\n            if (dataSlots === undefined) {\r\n              dataSlots = [];\r\n            }\r\n\r\n            dataSlots[daySlot] = 2;\r\n            $newContainer.data('slots', dataSlots);\r\n          }\r\n        }\r\n\r\n        $newEvent.css('top', 2 + 1.875 * daySlot + 'rem');\r\n\r\n        // Append event to container\r\n        $newEvent.appendTo($eventsContainer);\r\n\r\n        // Check container height and slots to show number of extra events\r\n        updateContainerExtraEvents($eventsContainer, slots);\r\n      }\r\n    }\r\n\r\n    // Create calendar\r\n    applyStyleOptions(options);\r\n    createCalendar();\r\n    addEventsToCalendar(events);\r\n\r\n    return true;\r\n  },\r\n});\r\n"],"sourceRoot":""}